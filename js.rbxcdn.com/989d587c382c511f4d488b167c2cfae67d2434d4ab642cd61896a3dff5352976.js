!function(){"use strict";var g=Roblox,P=CoreRobloxUtilities,a="/upgrades/paymentmethods",t="ItemPurchaseAjaxData",c="/games/",s="CommonUI.Controls",u="Feature.Premium",o="/v1/users/{userId}/currency",d="/v2/metadata/nextgen-purchase-status",p="/v1/products/{productId}/purchase",h="/v1/purchases/products/{productId}",i="/v1/products/{productId}",f="/purchase-warning/v1/purchase-warnings",m="/purchase-warning/v1/purchase-warnings/acknowledge",l="Success",v=5e3,y={GAME_PASS:"Game Pass",BUNDLE:"Bundle",BUNDLE_ALIAS:"Package"},b={GAME_PASS:"/v1/game-passes",BUNDLE:"/v1/bundles/thumbnails",ASSET:"/v1/assets"},E={size:"150x150",format:"Png",isCircular:!1},T={backToShopAction:"Action.BackToShop",buyRobuxAndItemAction:"Action.BuyRobuxAndItem",cancelAction:"Action.Cancel",equipMyAvatarAction:"Action.EquipMyAvatar",goToRobuxStoreAction:"Action.GoToRobuxStore",insufficientRobuxHeading:"Heading.InsufficientRobux",insufficientRobuxMessage:"Message.InsufficientRobux",insufficientRobuxExceedLargestPackageMessage:"Message.InsufficientRobuxExceedLargestPackage",purchaseSucceededHeading:"Heading.PurchaseSucceeded",purchaseSucceededMessage:"Message.PurchaseSucceeded",purchaseSucceededRobuxBalanceMessage:"Message.PurchaseSucceededRobuxBalance",purchasingTheItemLabel:"Label.PurchasingTheItem",waitingForRobuxLabel:"Label.WaitingForRobux",errorOccuredHeading:"Heading.ErrorOccured",purchasingUnavailableMessage:"Message.PurchasingUnavailable",purchaseErrorOccuredMessage:"Message.PurchaseErrorOccured",okAction:"Action.Ok",commonUiOkAction:"Action.OK",commonUiCancelAction:"Action.Cancel",featurePremiumScaryModalTitleHeading:"Heading.ScaryModalTitle",featurePremiumScaryModalBodyNewDescription:"Description.ScaryModalBodyNew",featurePremiumScaryModalBody13To17Description:"Description.ScaryModalBody13To17",featurePremiumScaryModalThreshold1BodyDescription:"Description.ScaryModalThreshold1Body",featurePremiumScaryModalThreshold2BodyDescription:"Description.ScaryModalThreshold2Body"},w={U13PaymentModal:"U13PaymentModal",ParentalConsentWarningPaymentModal13To17:"ParentalConsentWarningPaymentModal13To17",ParentalAuthorization13To17:"ParentalAuthorization13To17",U13MonthlyThreshold1Modal:"U13MonthlyThreshold1Modal",RequireEmailVerification:"RequireEmailVerification",U13MonthlyThreshold2Modal:"U13MonthlyThreshold2Modal",NoAction:"NoAction"},x={EVENT_NAME:"ItemPurchaseUpsellEvent",CONTEXT_NAME:{COOKIE_PARSE_FAILED:"COOKIE_PARSE_FAILED",PRODUCT_INFO_REQUEST_FAILED:"PRODUCT_INFO_REQUEST_FAILED",PRODUCT_INFO_EMPTY:"PRODUCT_INFO_EMPTY",PRODUCT_ID_NOT_EXIST:"PRODUCT_ID_NOT_EXIST",UPSELL_FAILED:"UPSELL_FAILED"}},n="WebCatalog",r="WebBundle",U="WebGamePass",S="NoTypeParsedYet",A={UnknownError:"UnknownError",UnknownErrorNoAsset:"UnknownErrorNoAsset",UpsellShown:"UpsellShown",UpsellCancelled:"UpsellCancelled",UpsellCancelledFromU13Modal:"UpsellCancelledFromU13Modal",UpsellContinued:"UpsellContinued",UpsellThumbnailProcessFailed:"UpsellThumbnailProcessFailed",UpsellExceedLargestEntryPoint:"UpsellExceedLargestEntryPoint",UpsellExceedLargestShown:"UpsellExceedLargestShown",UpsellExceedLargestCancelled:"UpsellExceedLargestCancelled",UpsellExceedLargestGoToRobuxStoreClicked:"UpsellExceedLargestGoToRobuxStoreClicked",UpsellExceedLargestModalExpTrue:"UpsellExceedLargestModalExpTrue",UpsellExceedLargestModalExpFalse:"UpsellExceedLargestModalExpTrue",UpsellExceedLargestModalExpError:"UpsellExceedLargestModalExpError",UpsellExceedLargestMetadataError:"UpsellExceedLargestMetadataError",UpsellExceedLargestNoThumbnailImage:"UpsellExceedLargestNoThumbnailImage",UpsellFromGamesPage:"UpsellFromGamesPage",UpsellFailed:"UpsellFailed",UpsellFailedDueToNoAvailablePackage:"UpsellFailedDueToNoAvailablePackage",UpsellFailedDueToFailedPackageRequest:"UpsellFailedDueToFailedPackageRequest",AutoPurchaseEntryPoint:"AutoPurchaseEntryPoint",AutoPurchaseStarted:"AutoPurchaseStarted",AutoPurchaseSucceed:"AutoPurchaseSucceed",AutoPurchaseSucceedClose:"AutoPurchaseSucceedClose",AutoPurchaseSucceedBackToShop:"AutoPurchaseSucceedBackToShop",AutoPurchaseSucceedEquipMyAvatar:"AutoPurchaseSucceedEquipMyAvatar",AutoPurchaseFailed:"AutoPurchaseFailed",AutoPurchaseErrorFromPurchaseApi:"AutoPurchaseErrorFromPurchaseApi",AutoPurchaseFailedDueToStillLowBalance:"AutoPurchaseFailedDueToStillLowBalance",AutoPurchasePotentialHackingActionSpotted:"AutoPurchasePotentialHackingActionSpotted",AutoPurchasePotentialHackingActionSpotted2:"AutoPurchasePotentialHackingActionSpotted2",AutoPurchasePotentialHackingActionSpotted3:"AutoPurchasePotentialHackingActionSpotted3",AutoPurchasePotentialHackingActionSpotted4:"AutoPurchasePotentialHackingActionSpotted4",ShowU13PaymentModal:"ShowU13PaymentModal",ShowU13MonthlyThreshold1Modal:"ShowU13MonthlyThreshold1Modal",ShowU13MonthlyThreshold2Modal:"ShowU13MonthlyThreshold2Modal",ShowParentalConsentWarningPaymentModal13To17Modal:"ShowParentalConsentWarningPaymentModal13To17Modal",ConfirmU13PaymentModal:"ConfirmU13PaymentModal",ConfirmU13MonthlyThreshold1Modal:"ConfirmU13MonthlyThreshold1Modal",ConfirmU13MonthlyThreshold2Modal:"ConfirmU13MonthlyThreshold2Modal",ConfirmParentalConsentWarningPaymentModal13To17Modal:"ConfirmParentalConsentWarningPaymentModal13To17Modal",U13PaymentModalEmailVerificationTriggered:"U13PaymentModalEmailVerificationTriggered",U13PaymentModalFailedToShow:"U13PaymentModalFailedToShow",U13PaymentModalNoAction:"U13PaymentModalNoAction"},e=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},M=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function I(r){return e(this,void 0,Promise,function(){var t,n;return M(this,function(e){switch(e.label){case 0:if(!r)return[2,!1];try{t=JSON.parse(r)}catch(e){return[2,!1]}e.label=1;case 1:return e.trys.push([1,3,,4]),[4,g.ExperimentationService.getAllValuesForLayer(t.LayerName)];case 2:return n=e.sent(),[2,null!=(n=n[t.Parameter])&&n];case 3:return e.sent(),[2,!1];case 4:return[2]}})})}var C=CoreUtilities,k=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},D=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function _(e,t){return void 0===t&&(t=!0),t?"<span class='icon-robux-16x16'></span><span class='text-robux'>"+g.NumberFormatting.commas(e)+"</span>":"<span class='icon-robux-gray-16x16'></span><span class='text'>"+g.NumberFormatting.commas(e)+"</span>"}var L=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},R=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function N(){var e;P.upsellUtil.expireUpsellCookie(),window.history&&((e=new URL(window.location.href)).searchParams.delete(P.upsellUtil.constants.UPSELL_QUERY_PARAM_KEY),e=e.href,window.history.pushState({path:e},"",e))}var B=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},O=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},F=window.EventTracker;function G(e){null!=F&&F.fireEvent(n+e)}function H(e,t){var n;t===y.BUNDLE||t===y.BUNDLE_ALIAS?(n=e,null!=F&&F.fireEvent(r+n)):t===y.GAME_PASS?(n=e,null!=F&&F.fireEvent(U+n)):G(t?e:A.UnknownErrorNoAsset)}function W(e,t,n,r,a){var o=r.getTranslationResource(u),i=r.getTranslationResource(s),l="<br /><br />",r={lineBreak:l,linebreak:l},l="";t===w.U13PaymentModal?l=o.get(T.featurePremiumScaryModalBodyNewDescription,r):t===w.ParentalConsentWarningPaymentModal13To17?l=o.get(T.featurePremiumScaryModalBody13To17Description,{}):t===w.U13MonthlyThreshold1Modal?l=o.get(T.featurePremiumScaryModalThreshold1BodyDescription,r):t===w.U13MonthlyThreshold2Modal&&(l=o.get(T.featurePremiumScaryModalThreshold2BodyDescription,r)),g.Dialog.open({titleText:o.get(T.featurePremiumScaryModalTitleHeading,{}),bodyContent:'<div><span class="text-description">'+l+'</span></div><div class="text-center"><div class="icon-warning"></div></div>',declineText:i.get(T.commonUiCancelAction,{}),acceptText:i.get(T.commonUiOkAction,{}),onAccept:function(){return function(r,a){return B(this,void 0,Promise,function(){var t,n;return O(this,function(e){switch(e.label){case 0:n={acknowledgement:"Confirmed"+r},t={url:""+g.EnvironmentUrls.apiGatewayUrl+m,withCredentials:!0,timeout:v},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.httpService.post(t,n)];case 2:return e.sent(),a(),[2,Promise.resolve()];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}(t,n).then(function(){t===w.U13PaymentModal?H(A.ConfirmU13PaymentModal,null==a?void 0:a.assetType):t===w.U13MonthlyThreshold1Modal?H(A.ConfirmU13MonthlyThreshold1Modal,null==a?void 0:a.assetType):t===w.U13MonthlyThreshold2Modal?H(A.ConfirmU13MonthlyThreshold2Modal,null==a?void 0:a.assetType):H(A.ConfirmParentalConsentWarningPaymentModal13To17Modal,null==a?void 0:a.assetType)}).catch(function(){n()}),!1},onDecline:function(){return H(A.UpsellCancelledFromU13Modal,null==a?void 0:a.assetType),N(),!1},onCancel:function(){return H(A.UpsellCancelledFromU13Modal,null==a?void 0:a.assetType),N(),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}var j=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},q=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function V(n,r,a,o,i){var l;return j(this,void 0,void 0,function(){var t;return q(this,function(e){switch(e.label){case 0:if(!r)return a(),[2,Promise.resolve()];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(a){return L(this,void 0,Promise,function(){var t,n,r;return R(this,function(e){switch(e.label){case 0:n=!g.CurrentUser.isPremiumUser,t={productId:a,is13To17ScaryModalEnabled:n},n={url:""+g.EnvironmentUrls.apiGatewayUrl+f,withCredentials:!0,timeout:v},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.httpService.get(n,t)];case 2:return 200===(r=e.sent()).status&&r.data.action?[2,Promise.resolve(r.data.action)]:[2,Promise.resolve(w.NoAction)];case 3:return r=e.sent(),[2,Promise.reject(r)];case 4:return[2]}})})}(n.roblox_product_id)];case 2:return(t=e.sent())===w.U13PaymentModal||t===w.ParentalConsentWarningPaymentModal13To17||t===w.U13MonthlyThreshold1Modal||t===w.U13MonthlyThreshold2Modal?(t===w.U13PaymentModal?H(A.ShowU13PaymentModal,null==i?void 0:i.assetType):t===w.U13MonthlyThreshold1Modal?H(A.ShowU13MonthlyThreshold1Modal,null==i?void 0:i.assetType):t===w.U13MonthlyThreshold2Modal?H(A.ShowU13MonthlyThreshold2Modal,null==i?void 0:i.assetType):H(A.ShowParentalConsentWarningPaymentModal13To17Modal,null==i?void 0:i.assetType),W(0,t,a,o,i)):t===w.RequireEmailVerification?(H(A.U13PaymentModalEmailVerificationTriggered,null==i?void 0:i.assetType),null!==(l=g.EmailVerificationService.handleUserEmailVerificationRequiredByPurchaseWarning())&&void 0!==l&&l.then(function(e){null!=e&&e.emailAddress&&null!=e&&e.verified&&a()})):(H(A.U13PaymentModalNoAction,null==i?void 0:i.assetType),a()),[2,Promise.resolve()];case 3:return t=e.sent(),[2,Promise.reject(t)];case 4:return[2]}})})}function X(e,t,n){var r=function(e){var t=P.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname);P.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0;var n=null;if(Array.isArray(t)&&0<t.length&&(n=t[0]),!n)return"";if(!e||Object.keys(e).length<4)return"";var r=C.uuidService.generateRandomUuid(),t=e.expectedCurrency+","+e.expectedPrice+","+e.expectedSellerId+","+(null!==(t=e.userassetId)&&void 0!==t?t:""),e=""+(e.productId||""),t=r+","+n+","+g.CurrentUser.userId+","+t+","+e;return(e=new Date).setHours(e.getHours()+1),e=[P.upsellUtil.constants.UPSELL_COOKIE_KEY,"=",encodeURIComponent(t),"; expires="+e.toUTCString(),"; path=/","; domain=.",g.EnvironmentUrls.domain,";"],document.cookie=e.join(""),r}(n);H(A.UpsellContinued,null==n?void 0:n.assetType),window.location.href=g.Endpoints.getAbsoluteUrl(a)+"?ap="+e.roblox_product_id+"&UpsellUuid="+r}function z(){var n=this;this.overlayDiv=null,this.contentDiv=null,this.loadingMessageSpan=null,this.spinnerSpan=null,this.loadingOverlayElementId="loading-overlay",this.show=function(e){var t=n.getOrCreateOverlayDiv(),t=n.getOrCreateContentDiv(t);return n.getOrCreateSpinnerSpan(t),n.updateOrCreateMessage(e),n},this.hide=function(){var e;null!==(e=null===(e=n.spinnerSpan)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.spinnerSpan),null!==(e=null===(e=n.loadingMessageSpan)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.loadingMessageSpan),null!==(e=null===(e=n.contentDiv)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.contentDiv),null!==(e=null===(e=n.overlayDiv)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.overlayDiv),n.overlayDiv=null,n.contentDiv=null,n.spinnerSpan=null,n.loadingMessageSpan=null},this.updateMessage=function(e){n._loadingMessage=e,n.updateOrCreateMessage(e)},this.updateOrCreateMessage=function(e){var t;if(n.overlayDiv)return e?void(n.loadingMessageSpan?n.loadingMessageSpan.innerText=e:((t=document.createElement("span")).innerText=e,t.classList.add("loading-message"),n.getOrCreateContentDiv(n.overlayDiv).appendChild(t),n.loadingMessageSpan=t)):(null!==(t=null===(t=n.loadingMessageSpan)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(n.loadingMessageSpan),void(n.loadingMessageSpan=null))},this.getOrCreateContentDiv=function(e){if(n.contentDiv)return n.contentDiv;var t=document.createElement("div");return t.classList.add("loading-overlay-content"),n.contentDiv=t,e.appendChild(t),t},this.getOrCreateOverlayDiv=function(){if(n.overlayDiv)return n.overlayDiv;var e=document.getElementById(n.loadingOverlayElementId);if(e)return n.overlayDiv=e;e=document.createElement("div");return(n.overlayDiv=e).id=n.loadingOverlayElementId,e.classList.add("loading-overlay"),document.body.appendChild(e),e},this.getOrCreateSpinnerSpan=function(e){if(n.spinnerSpan)return n.spinnerSpan;var t=document.createElement("span");return t.classList.add("spinner","spinner-default"),e.appendChild(t),n.spinnerSpan=t}}var K=(Object.defineProperty(z.prototype,"loadingMessage",{get:function(){return this._loadingMessage},enumerable:!1,configurable:!0}),z);function Y(e){P.upsellUtil.expireUpsellCookie(),window.location.href=g.Endpoints.getAbsoluteUrl(e)}function Q(e){var t;return"true"===(null===(t=null==e?void 0:e.gamePassUpsellExperimentBypass)||void 0===t?void 0:t.toLowerCase())||"true"===(null===(e=null==e?void 0:e.bundleItemUpsellExperimentBypass)||void 0===e?void 0:e.toLowerCase())}function J(e){return(null==e?void 0:e.catalogUpsellExperimentSerializedMetadata)||(null==e?void 0:e.gamePassUpsellExperimentSerializedMetadata)||(null==e?void 0:e.bundleItemUpsellExperimentSerializedMetadata)}var Z=function(e){var t;return"true"===(null===(t=null==e?void 0:e.isCatalogUpsellExperimentEnabled)||void 0===t?void 0:t.toLowerCase())||"true"===(null===(t=null==e?void 0:e.isGamePassUpsellExperimentEnabled)||void 0===t?void 0:t.toLowerCase())||"true"===(null===(e=null==e?void 0:e.isBundleItemUpsellExperimentEnabled)||void 0===e?void 0:e.toLowerCase())},$=function(e){return!(null==e||!e.catalogUpsellExperimentSerializedMetadata)||!(null==e||!e.gamePassUpsellExperimentSerializedMetadata)||!(null==e||!e.bundleItemUpsellExperimentSerializedMetadata)},ee=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},te=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},ne=function(){return(ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},re=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},ae=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function oe(e,t){try{g.EventStream.SendEventWithTarget(x.EVENT_NAME,e,t,g.EventStream.TargetTypes.WWW)}catch(e){}}var ie=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},le=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function se(e){N(),Y(e)}function ue(e){e&&(e.startsWith("/catalog/")||e.startsWith("/bundles/")||e.startsWith("/game-pass/")||e.startsWith(c))&&!e.includes("UpsellUuid=")||(P.upsellUtil.expireUpsellCookie(),window.location.href=g.Endpoints.getAbsoluteUrl("/catalog"))}function ce(n,r){return ie(this,void 0,Promise,function(){var t;return le(this,function(e){switch(e.label){case 0:if(!r)return[2,Promise.reject()];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(a){return ee(this,void 0,Promise,function(){var t,n,r;return te(this,function(e){switch(e.label){case 0:t={productId:a},n={url:""+g.EnvironmentUrls.economyApi+i,withCredentials:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.httpService.get(n,t)];case 2:return 200!==(r=e.sent()).status||r.data.reason!==l?[2,Promise.reject()]:[2,Promise.resolve(r.data)];case 3:return r=e.sent(),[2,Promise.reject(r)];case 4:return[2]}})})}(r)];case 2:return(t=e.sent())&&0!==Object.keys(t).length?[2,t]:(H(A.AutoPurchasePotentialHackingActionSpotted3,S),oe(x.CONTEXT_NAME.PRODUCT_INFO_EMPTY,{itemPath:n,productId:r}),[2,Promise.reject()]);case 3:return t=e.sent(),H(A.AutoPurchasePotentialHackingActionSpotted4,S),oe(x.CONTEXT_NAME.PRODUCT_INFO_REQUEST_FAILED,{itemPath:n,productId:r,error:t}),[2,Promise.reject(t)];case 4:return[2]}})})}function de(o,i,l){return ie(this,void 0,Promise,function(){var t,n,r,a;return le(this,function(e){switch(e.label){case 0:(a=P.upsellUtil.parseUpsellCookie())&&0!==Object.keys(a).length&&(!a.targetItemUrl||o.startsWith(a.targetItemUrl))||(H(A.AutoPurchasePotentialHackingActionSpotted2,S),oe(x.CONTEXT_NAME.COOKIE_PARSE_FAILED,{itemPath:o,upsellCookieData:a}),se(o)),(t=i)&&Z(t)&&$(t)||se(o),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,ce(o,a.productId)];case 2:return n=e.sent(),[3,4];case 3:return r=e.sent(),oe(x.CONTEXT_NAME.PRODUCT_ID_NOT_EXIST,{itemPath:o,upsellCookieData:a,error:r}),se(o),[2,Promise.reject()];case 4:return[4,function(r,a){return re(this,void 0,Promise,function(){var t,n;return ae(this,function(e){switch(e.label){case 0:n=a===y.GAME_PASS?(t=b.GAME_PASS,{gamePassIds:r}):a===y.BUNDLE?(t=b.BUNDLE,{bundleIds:r}):(t=b.ASSET,{assetIds:r}),n=ne(ne({},n),E),t={url:""+g.EnvironmentUrls.thumbnailsApi+t,withCredentials:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.httpService.get(t,n)];case 2:return 200===(n=e.sent()).status&&n.data.data&&0!==n.data.data.length?[2,Promise.resolve(n.data.data[0].imageUrl)]:[2,Promise.resolve(null)];case 3:return e.sent(),[2,Promise.resolve(null)];case 4:return[2]}})})}(n.assetId,n.assetType)];case 5:return r=e.sent(),t.imageurl=r||t.imageurl,a={expectedPrice:a.expectedPrice||"0",expectedCurrency:a.expectedCurrency||"1",expectedSellerId:a.expectedSellerId||"",itemId:n.assetId||(null==l?void 0:l.itemId),itemName:n.assetName||(null==l?void 0:l.itemName),assetType:n.assetType||(null==l?void 0:l.assetType),assetGranted:null==l?void 0:l.assetGranted,assetTypeDisplayName:n.assetTypeDisplayName||(null==l?void 0:l.assetTypeDisplayName),assetTypeId:null==l?void 0:l.assetTypeId,productId:n.productId||a.productId||(null==l?void 0:l.productId),itemType:n.assetType||(null==l?void 0:l.itemType),currentTime:null==l?void 0:l.currentTime,isPurchaseEnabled:null==l?void 0:l.isPurchaseEnabled,placeproductpromotionId:null==l?void 0:l.placeproductpromotionId,userassetId:a.userAssetId||(null==l?void 0:l.userassetId)},[2,[t,a]]}})})}function pe(t,e,n,r){var a="<span>"+n.get(T.purchaseSucceededRobuxBalanceMessage,{userRobuxBalance:_(e)})+"</span>",e="<div class='item-content'>\n        <div class='item-card-container item-preview'>\n          <div class='item-card-thumb'>\n            <img alt='item preview' src='"+t.itemThumbnailUrl+"'/>\n          </div>\n        </div>\n        <div class='text-center'>\n          "+n.get(T.purchaseSucceededMessage,{assetName:t.assetName})+"\n          "+a+"\n        </div>\n      </div>",a=t.assetType!==y.GAME_PASS?n.get(T.equipMyAvatarAction,{}):n.get(T.okAction,{});g.Dialog.open({titleText:n.get(T.purchaseSucceededHeading,{}),bodyContent:e,declineText:n.get(T.backToShopAction,{}),acceptText:a,acceptColor:"btn-primary-md",onAccept:function(){var e;return H(A.AutoPurchaseSucceedEquipMyAvatar,t.assetType),t.assetType!==y.GAME_PASS?void 0!==(e=g.Endpoints.getAbsoluteUrl("/my/avatar"))&&""!==e&&(P.upsellUtil.expireUpsellCookie(),window.location.href=e):t.itemPath.startsWith(c)?Y(t.itemPath+"?#!/store"):Y(t.itemPath),!1},onDecline:function(){return r.show(),H(A.AutoPurchaseSucceedBackToShop,t.assetType),Y(t.itemPath),!1},onCancel:function(){return H(A.AutoPurchaseSucceedClose,t.assetType),r.show(),Y(t.itemPath),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,showDecline:t.assetType!==y.GAME_PASS,dismissable:!1,xToCancel:!0})}function he(e,t){g.Dialog.open({titleText:t.get(T.errorOccuredHeading,{}),bodyContent:t.get(T.purchaseErrorOccuredMessage,{}),imageUrl:e.alertImageUrl,acceptText:t.get(T.okAction,{}),acceptColor:"btn-secondary-md",declineColor:"btn-none",dismissable:!0,allowHtmlContentInBody:!0})}var fe=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},me=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function ve(c,d,p,h){return fe(this,void 0,Promise,function(){var a,o,i,l,s,u;return me(this,function(e){switch(e.label){case 0:a={url:c,withCredentials:!0,retryable:!1,noCache:!0,noPragma:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),o={expectedCurrency:d.expectedCurrency,expectedPrice:d.expectedPrice,expectedSellerId:d.expectedSellerId,expectedPromoId:d.expectedPromoId,userAssetId:d.userAssetId},[4,C.httpService.post(a,o)];case 2:return(o=e.sent(),500===(o=o.data).statusCode)?(H(A.AutoPurchaseErrorFromPurchaseApi,d.assetType),void 0===o.showDivID&&(o.showDivID=o.showDivId),void 0===o.AssetID&&(o.AssetID=o.assetId),p.hide(),(0,g.ItemPurchase)().openErrorView(o),N(),[2,Promise.resolve()]):(d.isLibrary&&g.EventStream&&g.UrlParser&&(t=o.assetId,n=g.CurrentUser&&g.CurrentUser.userId,r=g.UrlParser.getParametersAsObject(),i={assetId:t,category:r.Category,creatorId:r.CreatorId,genre:r.GenreCsv,page:r.Page,position:r.Position,searchKeyword:r.SearchKeyword,sortAggregation:r.SortAggregation,sortType:r.SortType,userId:n,searchId:r.SearchId},g.EventStream.SendEventWithTarget("LibraryAssetAcquired","Marketplace",i,g.EventStream.TargetTypes.WWW)),H(A.AutoPurchaseSucceed,d.assetType),p.hide(),l=d.userBalance-d.expectedPrice,pe(d,l,h,p),[2,Promise.resolve()]);case 3:if(i=e.sent(),p.hide(),H(A.AutoPurchaseFailed,d.assetType),"object"!=typeof(l=i)||!("responseText"in l.request))return[2,Promise.reject(l.request)];if("Bad Request"===(s=l.request).responseText)he(d,h);else try{u=JSON.parse(s.responseText),(0,g.ItemPurchase)().openErrorView(u),N()}catch(e){return[2,Promise.reject(e)]}return[2,Promise.reject(i)];case 4:return[2]}var t,n,r})})}function ye(o,i,l,s){var u;return void 0===i&&(i=void 0),fe(this,void 0,Promise,function(){var t,n,r,a;return me(this,function(e){switch(e.label){case 0:if(null!==(u=o.itemContainerElemClassList)&&void 0!==u&&u.contains("btn-disabled-primary"))return[2,Promise.resolve()];if(t=""+g.EnvironmentUrls.passProductPurchasingApi+p.replace("{productId}",o.productId),n=""+g.EnvironmentUrls.bundlesProductPurchasingApi+p.replace("{productId}",o.productId),r=""+g.EnvironmentUrls.economyApi+h.replace("{productId}",o.productId),i)return[2,i({productId:o.productId,expectedPrice:o.expectedPrice,expectedCurrency:o.expectedCurrency,expectedPromoId:null===(u=o.expectedPromoId)||void 0===u?void 0:u.toString(),expectedSellerId:o.expectedSellerId,userAssetId:null===(u=o.userAssetId)||void 0===u?void 0:u.toString()})];H(A.AutoPurchaseStarted,o.assetType),e.label=1;case 1:return e.trys.push([1,3,,4]),a={url:""+g.EnvironmentUrls.economyApi+d,withCredentials:!0},[4,C.httpService.get(a)];case 2:if(200===(a=e.sent()).status){if(a.data.isNextGenPassProductPurchasingEnabled&&o.assetType===y.GAME_PASS)return[2,ve(t,o,l,s)];if(a.data.isNextGenBundlesProductPurchasingEnabled&&(o.assetType===y.BUNDLE||o.assetType===y.BUNDLE_ALIAS))return[2,ve(n,o,l,s)]}return[3,4];case 3:return e.sent(),[3,4];case 4:return[2,ve(r,o,l,s)]}})})}var be=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},ge=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Pe=function(e){e=document.querySelector('.PurchaseButton[data-product-id="'+e.productId+'"]'),e=null==e?void 0:e.closest(".store-card"),e=null==e?void 0:e.querySelector(".gear-passes-asset img");return e?e.src:null},Ee=function(e,t,n){if(void 0===n&&(n=window.location.pathname),n.startsWith(c)){if(!t)throw new Error("button data not exist");H(A.UpsellFromGamesPage,t.assetType);n=Pe(t);if(!n)throw H(A.UpsellThumbnailProcessFailed,t.assetType),new Error("thumbnail image url process failed");return n}return e.imageurl};function Te(e,t,n,r){var a=_(e),o=_(parseInt(n.expectedPrice,10)),e=t;window.location.pathname.startsWith(c)&&(e=null!==(t=Pe(n))&&void 0!==t?t:e);a="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+e+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,C.escapeHtml)()(n.itemName)+"</div>\n          <div class='text-robux item-card-price'>"+o+"</div>\n        </div>\n      </div>"+r.get(T.insufficientRobuxExceedLargestPackageMessage,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:a});H(A.UpsellExceedLargestShown,n.assetType),g.Dialog.open({titleText:r.get(T.insufficientRobuxHeading,{}),bodyContent:a,declineText:r.get(T.cancelAction,{}),acceptText:r.get(T.goToRobuxStoreAction,{}),acceptColor:"btn-primary-md",onAccept:function(){return window.location.href=g.Endpoints.getAbsoluteUrl("/upgrades/robux?ctx=upsell"),H(A.UpsellExceedLargestGoToRobuxStoreClicked,null==n?void 0:n.assetType),!1},onDecline:function(){H(A.UpsellExceedLargestCancelled,null==n?void 0:n.assetType)},onCancel:function(){H(A.UpsellCancelled,null==n?void 0:n.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}var we=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{o(s.next(e))}catch(e){t(e)}}function a(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}o((s=s.apply(e,i||[])).next())})},xe=function(n,r){var a,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],o=0}finally{a=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function Ue(){var t=this;this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this._checkBalanceAndPurchase=function(r,a){return we(t,void 0,Promise,function(){var t,n=this;return xe(this,function(e){switch(e.label){case 0:if(this._state.purchased)return[2,Promise.resolve()];e.label=1;case 1:return e.trys.push([1,5,,6]),t=this.translationResource.get(T.waitingForRobuxLabel,{}),this.loadingOverlay.updateMessage(t),[4,function(){return be(this,void 0,Promise,function(){var t,n;return ge(this,function(e){switch(e.label){case 0:t=g.CurrentUser.userId,t={url:""+g.EnvironmentUrls.economyApi+o.replace("{userId}",t),withCredentials:!0,retryable:!1,noCache:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.httpService.get(t)];case 2:return 200===(n=e.sent()).status?[2,n.data.robux]:[2,Promise.reject()];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}()];case 2:return t=e.sent(),(r.userBalance=t)>=r.expectedPrice?[4,ye(r,a,this.loadingOverlay,this.translationResource)]:[3,4];case 3:e.sent(),this._stopPeriodicChecking(),this._state.purchased=!0,e.label=4;case 4:return this._state.purchased||(0<this._state.retryRemainTimes?(this._state.timeoutHandle=setTimeout(function(){return we(n,void 0,void 0,function(){return xe(this,function(e){switch(e.label){case 0:return[4,this._checkBalanceAndPurchase(r,a)];case 1:return e.sent(),[2]}})})},5e3),--this._state.retryRemainTimes):(H(A.AutoPurchaseFailedDueToStillLowBalance,null==r?void 0:r.assetType),this._processGenericErrorState(r))),[3,6];case 5:return e.sent(),H(A.AutoPurchaseFailed,null==r?void 0:r.assetType),this._processGenericErrorState(r),[3,6];case 6:return[2,Promise.resolve()]}})})},this._stopPeriodicChecking=function(){t._state.timeoutHandle&&(clearTimeout(t._state.timeoutHandle),t._state.timeoutHandle=null)},this._processGenericErrorState=function(e){t.loadingOverlay.hide(),he(e,t.translationResource),N()},this.intl=new g.Intl,this.intlProvider=new g.TranslationResourceProvider(this.intl),this.translationResource=this.intlProvider.getTranslationResource("Purchasing.PurchaseDialog"),this.loadingOverlay=new K}var Se=(Ue.prototype.startItemUpsellProcess=function(h,f,m,v){var e,y,b;return void 0===v&&(v=null===(e=document.getElementById(t))||void 0===e?void 0:e.dataset),we(this,void 0,Promise,function(){var c,d,p;return xe(this,function(e){switch(e.label){case 0:if(!(c=v)||!Z(c)||!$(c))return m(h),[2,Promise.reject(h)];if(d=P.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname),P.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0,!Z(c)||!Array.isArray(d))return[3,6];e.label=1;case 1:return e.trys.push([1,5,,6]),[4,I(J(c))];case 2:return e.sent()||Q(c)?[4,function(r,a){return k(this,void 0,Promise,function(){var t,n;return D(this,function(e){switch(e.label){case 0:t=parseInt(r.userBalanceRobux,10),n={upsell_platform:"WEB",user_robux_balance:t,attempt_robux_amount:a.expectedItemPrice},t={url:g.EnvironmentUrls.apiGatewayUrl+"/payments-gateway/v1/products/get-upsell-product",withCredentials:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.httpService.post(t,n)];case 2:return[2,e.sent()];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}(c,f)]:[3,4];case 3:if(200===(p=e.sent()).status)return c.thumbnailImageUrl=Ee(c,f.buyButtonElementDataset),t=h,n=f,r=c,a=p.data,o=this.intl,i=this.translationResource,l=this.intlProvider,s=_(t.shortfallPrice,!1),u=_(a.robux_amount),t=_(n.expectedItemPrice),o="<a class='text-link-secondary terms-of-use-link' target='_blank' href='"+C.urlService.getUrlWithLocale("/info/terms",o.getRobloxLocale())+"'>",u="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+(null!==(r=r.thumbnailImageUrl)&&void 0!==r?r:"")+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,C.escapeHtml)()(n.assetName)+"</div>\n          <div class='text-robux item-card-price'>"+t+"</div>\n        </div>\n      </div>"+i.get(T.insufficientRobuxMessage,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:s,robuxPackageAmount:u,lineBreak:"",aTagStart:o,aTagEnd:"</a>"}),H(A.UpsellShown,null===(o=n.buyButtonElementDataset)||void 0===o?void 0:o.assetType),g.Dialog.open({titleText:i.get(T.insufficientRobuxHeading,{}),bodyContent:u,declineText:i.get(T.cancelAction,{}),acceptText:i.get(T.buyRobuxAndItemAction,{}),acceptColor:"btn-primary-md",onAccept:function(){return V(a,g.CurrentUser.isUnder13,function(){return X(a,0,n.buyButtonElementDataset)},l,n.buyButtonElementDataset).catch(function(){var e;H(A.U13PaymentModalFailedToShow,null===(e=n.buyButtonElementDataset)||void 0===e?void 0:e.assetType),X(a,0,n.buyButtonElementDataset)}),!1},onDecline:function(){var e;H(A.UpsellCancelled,null===(e=n.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},onCancel:function(){var e;H(A.UpsellCancelled,null===(e=n.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0}),[2,Promise.resolve()];204===p.status?H(A.UpsellFailedDueToNoAvailablePackage,null===(y=f.buyButtonElementDataset)||void 0===y?void 0:y.assetType):H(A.UpsellFailedDueToFailedPackageRequest,null===(b=f.buyButtonElementDataset)||void 0===b?void 0:b.assetType),e.label=4;case 4:return[3,6];case 5:return p=e.sent(),H(A.UpsellFailed,null===(b=f.buyButtonElementDataset)||void 0===b?void 0:b.assetType),m(h),[2,Promise.reject(p)];case 6:return m(h),[2,Promise.reject(h)]}var t,n,r,a,o,i,l,s,u})})},Ue.prototype.showExceedLargestInsufficientRobuxModal=function(n,r,a,o){var e;return void 0===o&&(o=null===(e=document.getElementById(t))||void 0===e?void 0:e.dataset),we(this,void 0,void 0,function(){var t;return xe(this,function(e){switch(e.label){case 0:if(H(A.UpsellExceedLargestEntryPoint,null==r?void 0:r.assetType),null==(t=o)||!t.newUpsellInsufficientRobuxModalExperimentMetadata)return H(A.UpsellExceedLargestMetadataError,null==r?void 0:r.assetType),a(),[2];if(null==t||!t.imageurl)return H(A.UpsellExceedLargestNoThumbnailImage,null==r?void 0:r.assetType),a(),[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I(t.newUpsellInsufficientRobuxModalExperimentMetadata)];case 2:return e.sent()?(Te(n,t.imageurl,r,this.translationResource),H(A.UpsellExceedLargestModalExpTrue,null==r?void 0:r.assetType),[2]):(H(A.UpsellExceedLargestModalExpFalse,null==r?void 0:r.assetType),[3,4]);case 3:return e.sent(),H(A.UpsellExceedLargestModalExpError,null==r?void 0:r.assetType),[3,4];case 4:return a(),[2]}})})},Ue.prototype.initiateAutoPurchase=function(o,i,l,s){var u;return void 0===l&&(l=document.getElementById(t)),void 0===s&&(s=document.getElementById("item-container")),we(this,void 0,Promise,function(){var t,n,r,a;return xe(this,function(e){switch(e.label){case 0:return this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this.loadingOverlay.show(),H(A.AutoPurchaseEntryPoint,S),ue(o),[4,function(u,c,d,p){return ie(this,void 0,Promise,function(){var t,n,r,a,o,i,l,s;return le(this,function(e){switch(e.label){case 0:return[4,de(p,d,c)];case 1:return i=e.sent(),s=i[0],t=i[1],n=t.placeproductpromotionId,l=g.MetaDataValues&&g.MetaDataValues.getPageName()||"",r="LibraryItem"===l,a=parseInt(s.userBalanceRobux,10),o=parseInt(t.expectedCurrency,10),i=parseInt(t.expectedPrice,10),l=parseInt(t.expectedSellerId,10),s={itemContainerElemClassList:null==u?void 0:u.classList,assetType:t.assetType,assetName:(0,C.escapeHtml)()(t.itemName),expectedSellerId:l,expectedCurrency:o,expectedPrice:i,productId:t.productId,isLibrary:r,itemThumbnailUrl:s.imageurl,itemPath:p,alertImageUrl:s.alerturl,userBalance:a,itemPurchaseAjaxData:s,itemDetail:t},n&&(s.expectedPromoId=parseInt(n,10)),t.userassetId&&(s.userAssetId=parseInt(t.userassetId,10)),[2,s]}})})}(s,null==s?void 0:s.dataset,null==l?void 0:l.dataset,o)];case 1:t=e.sent(),a=this.translationResource.get(T.purchasingTheItemLabel,{}),n=t.userBalance,r=t.expectedPrice,e.label=2;case 2:return e.trys.push([2,7,,8]),[4,I(J(t.itemPurchaseAjaxData))];case 3:return e.sent()||Q(t.itemPurchaseAjaxData)?(o.startsWith(c)&&null!==(u=document.getElementById("tab-store"))&&void 0!==u&&u.click(),r<n?(this.loadingOverlay.updateMessage(a),[4,ye(t,i,this.loadingOverlay,this.translationResource)]):[3,5]):(H(A.AutoPurchasePotentialHackingActionSpotted,null==t?void 0:t.assetType),[2,Y(o)]);case 4:return e.sent(),this._state.purchased=!0,[2,Promise.resolve()];case 5:return[4,this._checkBalanceAndPurchase(t,i)];case 6:return e.sent(),[3,8];case 7:return a=e.sent(),H(A.AutoPurchaseFailed,null==t?void 0:t.assetType),oe(x.CONTEXT_NAME.UPSELL_FAILED,{itemPurchaseObj:t,error:a}),N(),[3,8];case 8:return[2,Promise.resolve()]}})})},Ue);void 0===window.Roblox&&(window.Roblox={}),void 0===window.Roblox.ItemPurchaseUpsellService&&(window.Roblox.ItemPurchaseUpsellService=new Se)}();
//# sourceMappingURL=https://js.rbxcdn.com/c60835308b0c46789d19-itemPurchaseUpsell.bundle.min.js.map

/* Bundle detector */
window.Roblox && window.Roblox.BundleDetector && window.Roblox.BundleDetector.bundleDetected("ItemPurchaseUpsell");